BASE DE DATOS 

CREATE TABLE acudientes (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        paciente_id INTEGER NOT NULL,
        nombre_acudiente TEXT NOT NULL,
        cedula_acudiente TEXT,
        lugar_expedicion_acudiente TEXT,
        parentesco_acudiente TEXT,
        firma_acudiente TEXT,
        FOREIGN KEY (paciente_id) REFERENCES pacientes(id)
    )

CREATE TABLE consentimiento_secciones (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    consentimiento_id INTEGER,
    tipo TEXT,               -- texto | si_no | tabla_si_no | titulo
    contenido TEXT,          -- JSON
    orden INTEGER,
    activo INTEGER DEFAULT 1,
    FOREIGN KEY (consentimiento_id) REFERENCES consentimientos_definicion(id)
)

CREATE TABLE consentimientos (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        fecha TEXT NOT NULL,
        sede_id INTEGER NOT NULL,
        paciente_id INTEGER NOT NULL,
        doctor_id INTEGER,
        enfermero_id INTEGER,
        menor_id INTEGER,
        acudiente_id INTEGER,
        plantilla_usada TEXT,
        archivo_generado TEXT, tipo TEXT, datos TEXT, firma_paciente TEXT, firma_doctor TEXT, firma_enfermero TEXT, firma_acudiente TEXT, creado_en DATETIME DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (sede_id) REFERENCES sedes(id),
        FOREIGN KEY (paciente_id) REFERENCES pacientes(id),
        FOREIGN KEY (doctor_id) REFERENCES personal(id),
        FOREIGN KEY (enfermero_id) REFERENCES personal(id),
        FOREIGN KEY (menor_id) REFERENCES menores(id),
        FOREIGN KEY (acudiente_id) REFERENCES acudientes(id)
    )

CREATE TABLE consentimientos_definicion (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    paquete_id INTEGER,
    nombre TEXT NOT NULL,
    version TEXT NOT NULL,
    fecha_version TEXT NOT NULL,
    sede_id INTEGER,
    contenido TEXT NOT NULL,   -- TEXTO LARGO
    firma_paciente INTEGER DEFAULT 1,
    firma_medico INTEGER DEFAULT 0,
    firma_enfermero INTEGER DEFAULT 0,
    activo INTEGER DEFAULT 1,
    created_at TEXT
)
CREATE TABLE menores (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        paciente_id INTEGER NOT NULL,
        nombre_menor TEXT NOT NULL,
        cedula_menor TEXT,
        lugar_expedicion_menor TEXT,
        fecha_nacimiento TEXT,
        firma_menor TEXT,
        FOREIGN KEY (paciente_id) REFERENCES pacientes(id)
    )
CREATE TABLE pacientes (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        nombre TEXT NOT NULL,
        cedula TEXT NOT NULL UNIQUE,
        tipo_documento TEXT,
        lugar_expedicion TEXT,
        fecha_nacimiento TEXT,
        firma TEXT
    )

CREATE TABLE paquetes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nombre TEXT NOT NULL,
    descripcion TEXT,
    sede_id INTEGER NOT NULL,
    activo INTEGER DEFAULT 1,
    FOREIGN KEY (sede_id) REFERENCES sedes(id)
)
CREATE TABLE personal (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        nombre TEXT NOT NULL,
        tipo TEXT NOT NULL,   -- doctor o enfermero
        cedula TEXT,
        firma TEXT,
        sede_id INTEGER NOT NULL,
        FOREIGN KEY (sede_id) REFERENCES sedes(id)
    )

CREATE TABLE plantillas (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nombre TEXT NOT NULL,
    archivo_docx TEXT NOT NULL,
    version TEXT,
    tipo TEXT,               -- cirugia, terapia, general
    paquete_id INTEGER NOT NULL,
    activo INTEGER DEFAULT 1,
    FOREIGN KEY (paquete_id) REFERENCES paquetes(id)
)

CREATE TABLE plantillas_consentimiento (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nombre TEXT NOT NULL,
    titulo TEXT NOT NULL,
    contenido TEXT NOT NULL,
    activo INTEGER DEFAULT 1,
    sede_id INTEGER,
    created_at TEXT
, version TEXT, fecha_version TEXT, paquete_id INTEGER)

CREATE TABLE sedes (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        nombre TEXT NOT NULL,
        logo TEXT,
        ciudad TEXT,
        direccion TEXT,
        telefono TEXT,
        activo INTEGER DEFAULT 1
    )

CREATE TABLE usuarios (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        nombre TEXT NOT NULL,
        email TEXT NOT NULL UNIQUE,
        usuario TEXT NOT NULL UNIQUE,
        password TEXT NOT NULL,
        rol TEXT DEFAULT 'usuario',
        sede_id INTEGER NOT NULL,
        FOREIGN KEY (sede_id) REFERENCES sedes(id)
    )